<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Symptom Selector - MedAssist</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary:#2563EB;--primary-dark:#1D4ED8;--primary-light:#DBEAFE;
            --bg:#F0F4F8;--white:#FFFFFF;--text:#1A1A1A;--text-gray:#555;--text-light:#8B8B8B;
            --border:#E0E0E0;--shadow:0 2px 8px rgba(0,0,0,0.06);--radius:10px;
            --success:#10b981;--danger:#ef4444;--warning:#f59e0b;
        }
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;display:flex;height:100vh;overflow:hidden}

        /* ===== SIDEBAR ===== */
        .sidebar{width:260px;background:var(--white);border-right:1px solid var(--border);display:flex;flex-direction:column;height:100vh;overflow-y:auto;flex-shrink:0}
        .sidebar-header{padding:1.5rem 1.25rem;border-bottom:1px solid var(--border)}
        .logo{display:flex;align-items:center;gap:12px;text-decoration:none}
        .logo-icon{width:36px;height:36px;background:var(--primary);border-radius:6px;display:flex;align-items:center;justify-content:center;color:var(--white);font-size:16px}
        .logo-text{font-size:1.2rem;font-weight:700;color:var(--text)}
        .sidebar-nav{flex:1;padding:1rem 0}
        .nav-section{margin-bottom:1.5rem}
        .nav-section-title{padding:0 1.25rem;font-size:.7rem;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem}
        .nav-item{display:flex;align-items:center;gap:10px;padding:.6rem 1.25rem;color:var(--text-gray);text-decoration:none;font-size:.85rem;font-weight:500;transition:all .2s;cursor:pointer}
        .nav-item:hover{background:var(--bg);color:var(--primary)}
        .nav-item.active{color:var(--primary);background:var(--primary-light);font-weight:600}
        .nav-item i{width:20px;text-align:center;font-size:.9rem}
        .sidebar-footer{padding:1rem 1.25rem;border-top:1px solid var(--border)}
        .user-profile{display:flex;align-items:center;gap:10px;margin-bottom:.75rem}
        .user-avatar{width:36px;height:36px;border-radius:50%;background:var(--primary-light);display:flex;align-items:center;justify-content:center;color:var(--primary);font-size:.85rem;overflow:hidden}
        .user-avatar img{width:100%;height:100%;object-fit:cover}
        .user-details{flex:1;min-width:0}
        .user-name{font-size:.85rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .user-email{font-size:.7rem;color:var(--text-light);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .btn-logout{display:flex;align-items:center;gap:8px;padding:.5rem .75rem;color:var(--danger);text-decoration:none;font-size:.8rem;font-weight:500;border-radius:var(--radius);transition:background .2s}
        .btn-logout:hover{background:#FEE2E2}

        /* ===== MAIN ===== */
        .main-content{flex:1;overflow-y:auto;padding:1.5rem 2rem}
        .page-header{margin-bottom:1.25rem}
        .page-title{font-size:1.4rem;font-weight:700;display:flex;align-items:center;gap:10px}
        .page-title i{color:var(--primary)}
        .page-subtitle{font-size:.85rem;color:var(--text-gray);margin-top:2px}

        /* ===== LAYOUT ===== */
        .body-selector-layout{display:grid;grid-template-columns:1fr 360px;gap:1.25rem;margin-bottom:1.25rem}

        /* ===== SVG PANEL ===== */
        .svg-panel{background:var(--white);border-radius:var(--radius);border:1px solid var(--border);padding:1rem;display:flex;flex-direction:column;align-items:center}
        .view-toggle{display:flex;background:var(--bg);border-radius:8px;padding:4px;margin-bottom:1rem;gap:4px}
        .view-btn{padding:8px 24px;border:none;background:transparent;color:var(--text-gray);font-family:'Inter',sans-serif;font-size:.82rem;font-weight:600;border-radius:6px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:6px}
        .view-btn.active{background:var(--white);color:var(--primary);box-shadow:0 1px 4px rgba(0,0,0,.1)}
        .view-btn:hover:not(.active){color:var(--primary)}
        .svg-wrapper{display:flex;align-items:center;justify-content:center;width:100%;position:relative;background:#fff;border-radius:8px;padding:10px 0}
        .svg-wrapper svg{width:100%;max-width:360px;height:auto;display:block}
        .body-view{display:none}
        .body-view.active{display:flex;align-items:center;justify-content:center;width:100%}

        /* ===== MUSCLE POLYGONS ===== */
        .muscle{
            fill:#c0ccda;
            stroke:#fff;
            stroke-width:2.2;
            stroke-linejoin:round;
            cursor:pointer;
            transition:fill .2s ease,filter .2s ease,stroke .2s ease;
        }
        .muscle:hover{
            fill:#7baad6;
            filter:drop-shadow(0 0 6px rgba(109,163,212,.5));
        }
        .muscle.selected{
            fill:#5b8fb9;
            stroke:#3b7daa;
            stroke-width:2;
            filter:drop-shadow(0 0 8px rgba(59,130,246,.5));
        }
        .muscle.selected:hover{
            fill:#4a80ab;
        }
        .detail-line{fill:none;stroke:#a8b8c8;stroke-width:.6;pointer-events:none;opacity:.5}

        /* ===== TOOLTIP ===== */
        .muscle-tooltip{position:absolute;background:rgba(30,58,95,.92);color:#fff;padding:5px 10px;border-radius:6px;font-size:.72rem;font-weight:500;pointer-events:none;z-index:100;white-space:nowrap;opacity:0;transition:opacity .15s;transform:translate(-50%,-100%);margin-top:-8px}
        .muscle-tooltip.show{opacity:1}

        /* ===== INFO PANEL ===== */
        .info-panel{background:var(--white);border-radius:var(--radius);border:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;max-height:620px}
        .info-panel-header{padding:1rem 1.25rem;border-bottom:1px solid var(--border);background:linear-gradient(135deg,#2563eb 0%,#1d4ed8 100%);color:#fff}
        .info-panel-header h3{font-size:.95rem;font-weight:600;display:flex;align-items:center;gap:8px}
        .info-panel-body{padding:1.25rem;flex:1;overflow-y:auto}
        .info-placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:2.5rem 1rem;color:var(--text-light)}
        .info-placeholder i{font-size:2.5rem;margin-bottom:.75rem;color:#d0d8e0}
        .info-placeholder p{font-size:.85rem;line-height:1.6}
        .info-detail{display:none}
        .info-detail.visible{display:block;animation:fadeIn .3s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
        .info-part-icon{width:40px;height:40px;border-radius:10px;background:var(--primary-light);display:flex;align-items:center;justify-content:center;color:var(--primary);font-size:1.1rem;margin-bottom:.75rem}
        .info-part-name{font-size:1.15rem;font-weight:700;color:var(--primary);margin-bottom:2px}
        .info-part-region{font-size:.75rem;color:var(--text-light);text-transform:uppercase;letter-spacing:.5px;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:1px solid var(--border)}
        .info-section{margin-bottom:1rem}
        .info-section-title{font-size:.72rem;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.4rem;display:flex;align-items:center;gap:5px}
        .info-section-title i{font-size:.65rem;color:var(--primary)}
        .info-description{font-size:.82rem;color:var(--text-gray);line-height:1.65}
        .causes-list,.symptoms-list{list-style:none;padding:0}
        .causes-list li,.symptoms-list li{display:flex;align-items:center;gap:7px;padding:.4rem .6rem;font-size:.79rem;color:var(--text-gray);background:var(--bg);border-radius:6px;margin-bottom:4px;transition:all .2s}
        .causes-list li:hover{background:var(--primary-light);color:var(--primary)}
        .causes-list li i{color:var(--warning);font-size:.65rem;flex-shrink:0}
        .symptoms-list li i{color:var(--success);font-size:.65rem;flex-shrink:0}

        /* ===== SELECTED PANEL ===== */
        .selected-panel{background:var(--white);border-radius:var(--radius);border:1px solid var(--border);padding:1rem 1.25rem}
        .selected-panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem}
        .selected-panel-header h3{font-size:.9rem;font-weight:600;display:flex;align-items:center;gap:8px}
        .selected-count{background:var(--primary);color:#fff;font-size:.68rem;font-weight:600;padding:2px 8px;border-radius:20px;min-width:22px;text-align:center}
        .btn-clear{font-size:.75rem;color:var(--danger);background:none;border:none;cursor:pointer;font-weight:500;padding:4px 8px;border-radius:4px;transition:background .2s}
        .btn-clear:hover{background:#FEE2E2}
        .selected-tags{display:flex;flex-wrap:wrap;gap:6px;min-height:32px;margin-bottom:.75rem}
        .selected-tag{display:flex;align-items:center;gap:5px;padding:5px 11px;background:var(--primary-light);color:var(--primary);border-radius:20px;font-size:.76rem;font-weight:500;cursor:pointer;animation:tagPop .25s ease;transition:all .2s}
        @keyframes tagPop{from{opacity:0;transform:scale(.85)}to{opacity:1;transform:scale(1)}}
        .selected-tag:hover{background:var(--primary);color:#fff}
        .selected-tag .tag-remove{font-size:.6rem}
        .empty-selection{color:var(--text-light);font-size:.8rem;font-style:italic}
        .submit-row{display:flex;align-items:center;gap:1rem}
        .btn-submit{display:inline-flex;align-items:center;gap:8px;padding:.65rem 1.4rem;background:var(--primary);color:#fff;border:none;border-radius:var(--radius);font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif}
        .btn-submit:hover{background:var(--primary-dark);transform:translateY(-1px);box-shadow:0 4px 12px rgba(37,99,235,.3)}
        .btn-submit:disabled{background:var(--border);color:var(--text-light);cursor:not-allowed;transform:none;box-shadow:none}
        .btn-submit .spinner{width:15px;height:15px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        .submit-hint{font-size:.78rem;color:var(--text-light)}

        /* ===== ALERT ===== */
        .alert{position:fixed;top:1.5rem;right:1.5rem;padding:.9rem 1.4rem;border-radius:var(--radius);font-size:.82rem;font-weight:500;display:flex;align-items:center;gap:10px;z-index:9999;animation:alertSlide .3s ease;box-shadow:0 4px 16px rgba(0,0,0,.12);max-width:420px}
        @keyframes alertSlide{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
        .alert-success{background:#ECFDF5;color:#065F46;border:1px solid #A7F3D0}
        .alert-error{background:#FEF2F2;color:#991B1B;border:1px solid #FECACA}

        @media(max-width:1100px){.body-selector-layout{grid-template-columns:1fr}}
        @media(max-width:768px){.sidebar{display:none}}
    </style>
</head>
<body>
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="/dashboard" class="logo">
                <div class="logo-icon"><i class="fas fa-heartbeat"></i></div>
                <div class="logo-text">MedAssist</div>
            </a>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main</div>
                <a href="/dashboard" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
                <a href="/chat" class="nav-item"><i class="fas fa-comment-medical"></i><span>Chat</span></a>
                <a href="/health-tracker" class="nav-item"><i class="fas fa-chart-line"></i><span>Health Tracker</span></a>
                <a href="/body-selector" class="nav-item active"><i class="fas fa-person"></i><span>Body Selector</span></a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Community</div>
                <a href="/community" class="nav-item"><i class="fas fa-users"></i><span>Community</span></a>
                <a href="/report-issue" class="nav-item"><i class="fas fa-bullhorn"></i><span>Report Issue</span></a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Profile</div>
                <a href="/profile" class="nav-item"><i class="fas fa-user-circle"></i><span>My Account</span></a>
            </div>
        </nav>
        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">
                    {% if user.profile_image_path %}
                    <img src="{{ user.profile_image_path }}" alt="Profile">
                    {% else %}
                    <i class="fas fa-user"></i>
                    {% endif %}
                </div>
                <div class="user-details">
                    <div class="user-name">{{ user.name }}</div>
                    <div class="user-email">{{ user.email }}</div>
                </div>
            </div>
            <a href="/logout" class="btn-logout"><i class="fas fa-sign-out-alt"></i><span>Sign out</span></a>
        </div>
    </aside>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title"><i class="fas fa-person"></i> Body Symptom Selector</h1>
            <p class="page-subtitle">Select front or back view, then click muscle groups where you feel discomfort.</p>
        </div>

        <div class="body-selector-layout">
            <!-- SVG PANEL -->
            <div class="svg-panel">
                <div class="view-toggle">
                    <button class="view-btn active" data-view="front"><i class="fas fa-person"></i> Front View</button>
                    <button class="view-btn" data-view="back"><i class="fas fa-person-walking-arrow-loop-left"></i> Back View</button>
                </div>

                <div class="svg-wrapper">
                    <div class="muscle-tooltip" id="muscleTooltip"></div>

                    <!-- ==================== FRONT VIEW ==================== -->
                    <div class="body-view active" id="frontView">
                        <svg viewBox="0 0 400 700" xmlns="http://www.w3.org/2000/svg">
                            <!-- HEAD -->
                            <polygon class="muscle" data-name="Head"
                                points="200,16 224,24 232,48 226,72 200,80 174,72 168,48 176,24"/>
                            <!-- NECK -->
                            <polygon class="muscle" data-name="Neck"
                                points="188,80 212,80 216,90 218,100 182,100 184,90"/>
                            <!-- LEFT TRAPEZIUS -->
                            <polygon class="muscle" data-name="Left Trapezius"
                                points="218,100 240,94 268,98 296,110 282,122 258,118 238,112 218,107"/>
                            <!-- RIGHT TRAPEZIUS -->
                            <polygon class="muscle" data-name="Right Trapezius"
                                points="182,100 160,94 132,98 104,110 118,122 142,118 162,112 182,107"/>
                            <!-- LEFT DELTOID -->
                            <polygon class="muscle" data-name="Left Deltoid"
                                points="296,110 318,102 340,114 344,136 336,156 318,162 304,148 296,130"/>
                            <!-- RIGHT DELTOID -->
                            <polygon class="muscle" data-name="Right Deltoid"
                                points="104,110 82,102 60,114 56,136 64,156 82,162 96,148 104,130"/>
                            <!-- LEFT PECTORAL -->
                            <polygon class="muscle" data-name="Left Pectoral"
                                points="258,118 218,107 200,112 200,190 218,198 252,192 276,176 286,152 282,122"/>
                            <!-- RIGHT PECTORAL -->
                            <polygon class="muscle" data-name="Right Pectoral"
                                points="142,118 182,107 200,112 200,190 182,198 148,192 124,176 114,152 118,122"/>
                            <!-- LEFT BICEP -->
                            <polygon class="muscle" data-name="Left Bicep"
                                points="318,162 336,156 342,178 344,204 340,232 334,248 320,252 308,242 304,222 302,196 306,170"/>
                            <!-- RIGHT BICEP -->
                            <polygon class="muscle" data-name="Right Bicep"
                                points="82,162 64,156 58,178 56,204 60,232 66,248 80,252 92,242 96,222 98,196 94,170"/>
                            <!-- LEFT FOREARM -->
                            <polygon class="muscle" data-name="Left Forearm"
                                points="334,252 344,254 352,280 356,312 354,342 348,358 336,362 326,354 322,334 320,308 322,280 326,260"/>
                            <!-- RIGHT FOREARM -->
                            <polygon class="muscle" data-name="Right Forearm"
                                points="66,252 56,254 48,280 44,312 46,342 52,358 64,362 74,354 78,334 80,308 78,280 74,260"/>
                            <!-- LEFT HAND -->
                            <polygon class="muscle" data-name="Left Hand"
                                points="348,362 356,366 362,388 360,412 354,422 340,426 332,414 330,394 336,372"/>
                            <!-- RIGHT HAND -->
                            <polygon class="muscle" data-name="Right Hand"
                                points="52,362 44,366 38,388 40,412 46,422 60,426 68,414 70,394 64,372"/>
                            <!-- UPPER ABDOMINALS -->
                            <polygon class="muscle" data-name="Upper Abdominals"
                                points="200,190 218,198 218,240 200,248 182,240 182,198"/>
                            <!-- LOWER ABDOMINALS -->
                            <polygon class="muscle" data-name="Lower Abdominals"
                                points="200,248 218,240 218,282 200,290 182,282 182,240"/>
                            <!-- LEFT OBLIQUE -->
                            <polygon class="muscle" data-name="Left Oblique"
                                points="252,192 218,198 218,282 230,288 254,280 266,258 270,234 272,212 268,196"/>
                            <!-- RIGHT OBLIQUE -->
                            <polygon class="muscle" data-name="Right Oblique"
                                points="148,192 182,198 182,282 170,288 146,280 134,258 130,234 128,212 132,196"/>
                            <!-- HIP / PELVIS -->
                            <polygon class="muscle" data-name="Hip / Pelvis"
                                points="230,288 218,282 200,290 182,282 170,288 158,308 154,332 158,355 170,370 200,378 230,370 242,355 246,332 242,308"/>
                            <!-- LEFT QUADRICEP -->
                            <polygon class="muscle" data-name="Left Quadricep"
                                points="230,370 242,355 246,382 244,418 240,452 234,480 226,502 218,510 214,498 218,466 222,434 225,404 228,382"/>
                            <!-- LEFT INNER THIGH -->
                            <polygon class="muscle" data-name="Left Inner Thigh"
                                points="218,374 228,382 225,404 222,434 218,466 214,498 208,506 202,492 200,462 200,428 200,398 200,378 210,374"/>
                            <!-- RIGHT QUADRICEP -->
                            <polygon class="muscle" data-name="Right Quadricep"
                                points="170,370 158,355 154,382 156,418 160,452 166,480 174,502 182,510 186,498 182,466 178,434 175,404 172,382"/>
                            <!-- RIGHT INNER THIGH -->
                            <polygon class="muscle" data-name="Right Inner Thigh"
                                points="182,374 172,382 175,404 178,434 182,466 186,498 192,506 198,492 200,462 200,428 200,398 200,378 190,374"/>
                            <!-- LEFT KNEE -->
                            <polygon class="muscle" data-name="Left Knee"
                                points="226,512 234,508 240,520 238,534 228,540 214,540 208,534 210,520 214,512"/>
                            <!-- RIGHT KNEE -->
                            <polygon class="muscle" data-name="Right Knee"
                                points="174,512 166,508 160,520 162,534 172,540 186,540 192,534 190,520 186,512"/>
                            <!-- LEFT SHIN -->
                            <polygon class="muscle" data-name="Left Shin"
                                points="214,542 228,542 232,560 232,588 230,614 226,636 220,652 214,656 208,650 204,632 204,608 204,580 206,558"/>
                            <!-- LEFT CALF -->
                            <polygon class="muscle" data-name="Left Calf"
                                points="228,542 240,542 246,562 248,592 246,618 242,640 234,656 228,660 220,652 226,636 230,614 232,588 232,560"/>
                            <!-- RIGHT SHIN -->
                            <polygon class="muscle" data-name="Right Shin"
                                points="186,542 172,542 168,560 168,588 170,614 174,636 180,652 186,656 192,650 196,632 196,608 196,580 194,558"/>
                            <!-- RIGHT CALF -->
                            <polygon class="muscle" data-name="Right Calf"
                                points="172,542 160,542 154,562 152,592 154,618 158,640 166,656 172,660 180,652 174,636 170,614 168,588 168,560"/>
                            <!-- LEFT FOOT -->
                            <polygon class="muscle" data-name="Left Foot"
                                points="214,660 234,660 240,670 242,686 238,696 222,700 210,696 206,686 208,672"/>
                            <!-- RIGHT FOOT -->
                            <polygon class="muscle" data-name="Right Foot"
                                points="186,660 166,660 160,670 158,686 162,696 178,700 190,696 194,686 192,672"/>

                            <!-- Detail lines (non-interactive) -->
                            <line class="detail-line" x1="200" y1="194" x2="200" y2="286"/>
                            <line class="detail-line" x1="184" y1="212" x2="216" y2="212"/>
                            <line class="detail-line" x1="184" y1="228" x2="216" y2="228"/>
                            <line class="detail-line" x1="184" y1="258" x2="216" y2="258"/>
                            <line class="detail-line" x1="184" y1="272" x2="216" y2="272"/>
                            <line class="detail-line" x1="200" y1="296" x2="190" y2="360"/>
                            <line class="detail-line" x1="200" y1="296" x2="210" y2="360"/>
                            <line class="detail-line" x1="230" y1="380" x2="220" y2="500"/>
                            <line class="detail-line" x1="170" y1="380" x2="180" y2="500"/>
                        </svg>
                    </div>

                    <!-- ==================== BACK VIEW ==================== -->
                    <div class="body-view" id="backView">
                        <svg viewBox="0 0 400 700" xmlns="http://www.w3.org/2000/svg">
                            <!-- HEAD (BACK) -->
                            <polygon class="muscle" data-name="Head (Back)"
                                points="200,16 224,24 232,48 226,72 200,80 174,72 168,48 176,24"/>
                            <!-- NECK (BACK) -->
                            <polygon class="muscle" data-name="Neck (Back)"
                                points="188,80 212,80 216,90 218,100 182,100 184,90"/>
                            <!-- LEFT TRAPEZIUS -->
                            <polygon class="muscle" data-name="Left Trapezius"
                                points="218,100 242,94 272,97 298,110 284,124 260,118 238,112 218,107"/>
                            <!-- RIGHT TRAPEZIUS -->
                            <polygon class="muscle" data-name="Right Trapezius"
                                points="182,100 158,94 128,97 102,110 116,124 140,118 162,112 182,107"/>
                            <!-- LEFT REAR DELTOID -->
                            <polygon class="muscle" data-name="Left Rear Deltoid"
                                points="298,110 320,102 340,114 344,136 336,156 318,162 304,148 296,130 296,114"/>
                            <!-- RIGHT REAR DELTOID -->
                            <polygon class="muscle" data-name="Right Rear Deltoid"
                                points="102,110 80,102 60,114 56,136 64,156 82,162 96,148 104,130 104,114"/>
                            <!-- LEFT UPPER BACK -->
                            <polygon class="muscle" data-name="Left Upper Back"
                                points="260,118 218,107 200,112 200,162 220,168 252,162 274,148 282,132 282,122"/>
                            <!-- RIGHT UPPER BACK -->
                            <polygon class="muscle" data-name="Right Upper Back"
                                points="140,118 182,107 200,112 200,162 180,168 148,162 126,148 118,132 118,122"/>
                            <!-- SPINE / MID BACK -->
                            <polygon class="muscle" data-name="Spine / Mid Back"
                                points="200,162 220,168 220,218 216,252 210,272 200,276 190,272 184,252 180,218 180,168"/>
                            <!-- LEFT LATISSIMUS DORSI -->
                            <polygon class="muscle" data-name="Left Latissimus Dorsi"
                                points="252,162 220,168 220,218 216,252 230,274 256,264 270,242 274,218 274,196 270,172"/>
                            <!-- RIGHT LATISSIMUS DORSI -->
                            <polygon class="muscle" data-name="Right Latissimus Dorsi"
                                points="148,162 180,168 180,218 184,252 170,274 144,264 130,242 126,218 126,196 130,172"/>
                            <!-- LEFT TRICEP -->
                            <polygon class="muscle" data-name="Left Tricep"
                                points="318,162 336,156 342,178 344,204 340,232 334,248 320,252 308,242 304,222 302,196 306,170"/>
                            <!-- RIGHT TRICEP -->
                            <polygon class="muscle" data-name="Right Tricep"
                                points="82,162 64,156 58,178 56,204 60,232 66,248 80,252 92,242 96,222 98,196 94,170"/>
                            <!-- LEFT FOREARM (BACK) -->
                            <polygon class="muscle" data-name="Left Forearm"
                                points="334,252 344,254 352,280 356,312 354,342 348,358 336,362 326,354 322,334 320,308 322,280 326,260"/>
                            <!-- RIGHT FOREARM (BACK) -->
                            <polygon class="muscle" data-name="Right Forearm"
                                points="66,252 56,254 48,280 44,312 46,342 52,358 64,362 74,354 78,334 80,308 78,280 74,260"/>
                            <!-- LEFT HAND (BACK) -->
                            <polygon class="muscle" data-name="Left Hand"
                                points="348,362 356,366 362,388 360,412 354,422 340,426 332,414 330,394 336,372"/>
                            <!-- RIGHT HAND (BACK) -->
                            <polygon class="muscle" data-name="Right Hand"
                                points="52,362 44,366 38,388 40,412 46,422 60,426 68,414 70,394 64,372"/>
                            <!-- LOWER BACK -->
                            <polygon class="muscle" data-name="Lower Back"
                                points="230,274 216,252 200,276 184,252 170,274 158,296 154,322 158,348 170,365 200,374 230,365 242,348 246,322 242,296"/>
                            <!-- LEFT GLUTE -->
                            <polygon class="muscle" data-name="Left Glute"
                                points="230,365 242,348 244,380 240,408 232,426 218,434 205,430 200,420 200,392 200,374 212,368"/>
                            <!-- RIGHT GLUTE -->
                            <polygon class="muscle" data-name="Right Glute"
                                points="170,365 158,348 156,380 160,408 168,426 182,434 195,430 200,420 200,392 200,374 188,368"/>
                            <!-- LEFT HAMSTRING -->
                            <polygon class="muscle" data-name="Left Hamstring"
                                points="232,436 244,422 248,454 246,482 240,504 230,516 218,516 210,510 206,490 204,464 204,440 210,434 218,436"/>
                            <!-- RIGHT HAMSTRING -->
                            <polygon class="muscle" data-name="Right Hamstring"
                                points="168,436 156,422 152,454 154,482 160,504 170,516 182,516 190,510 194,490 196,464 196,440 190,434 182,436"/>
                            <!-- LEFT KNEE (BACK) -->
                            <polygon class="muscle" data-name="Left Knee (Back)"
                                points="226,518 236,514 240,526 238,540 228,546 214,546 208,540 210,526 214,518"/>
                            <!-- RIGHT KNEE (BACK) -->
                            <polygon class="muscle" data-name="Right Knee (Back)"
                                points="174,518 164,514 160,526 162,540 172,546 186,546 192,540 190,526 186,518"/>
                            <!-- LEFT CALF (BACK) -->
                            <polygon class="muscle" data-name="Left Calf"
                                points="214,548 238,548 244,570 246,598 244,624 240,646 232,662 222,666 214,662 208,656 204,638 202,614 202,588 204,566"/>
                            <!-- RIGHT CALF (BACK) -->
                            <polygon class="muscle" data-name="Right Calf"
                                points="186,548 162,548 156,570 154,598 156,624 160,646 168,662 178,666 186,662 192,656 196,638 198,614 198,588 196,566"/>
                            <!-- LEFT ACHILLES -->
                            <polygon class="muscle" data-name="Left Achilles"
                                points="222,666 232,662 236,678 234,690 226,692 218,692 216,682"/>
                            <!-- RIGHT ACHILLES -->
                            <polygon class="muscle" data-name="Right Achilles"
                                points="178,666 168,662 164,678 166,690 174,692 182,692 184,682"/>
                            <!-- LEFT FOOT (BACK) -->
                            <polygon class="muscle" data-name="Left Foot"
                                points="216,694 236,694 242,702 244,716 240,724 224,728 210,724 206,716 208,704"/>
                            <!-- RIGHT FOOT (BACK) -->
                            <polygon class="muscle" data-name="Right Foot"
                                points="184,694 164,694 158,702 156,716 160,724 176,728 190,724 194,716 192,704"/>

                            <!-- Detail lines -->
                            <line class="detail-line" x1="200" y1="112" x2="200" y2="162"/>
                            <line class="detail-line" x1="200" y1="168" x2="200" y2="274"/>
                            <line class="detail-line" x1="188" y1="180" x2="212" y2="180"/>
                            <line class="detail-line" x1="186" y1="200" x2="214" y2="200"/>
                            <line class="detail-line" x1="186" y1="220" x2="214" y2="220"/>
                            <line class="detail-line" x1="188" y1="240" x2="212" y2="240"/>
                            <polyline class="detail-line" points="240,126 250,132 252,148 246,158 234,162 228,156"/>
                            <polyline class="detail-line" points="160,126 150,132 148,148 154,158 166,162 172,156"/>
                            <line class="detail-line" x1="200" y1="378" x2="200" y2="430"/>
                            <line class="detail-line" x1="228" y1="440" x2="222" y2="510"/>
                            <line class="detail-line" x1="172" y1="440" x2="178" y2="510"/>
                            <line class="detail-line" x1="224" y1="554" x2="224" y2="654"/>
                            <line class="detail-line" x1="176" y1="554" x2="176" y2="654"/>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- ===== INFO PANEL ===== -->
            <div class="info-panel">
                <div class="info-panel-header">
                    <h3><i class="fas fa-stethoscope"></i> Muscle / Body Part Details</h3>
                </div>
                <div class="info-panel-body">
                    <div class="info-placeholder" id="infoPlaceholder">
                        <i class="fas fa-hand-pointer"></i>
                        <p>Hover over or click a muscle group<br>to see detailed medical information</p>
                    </div>
                    <div class="info-detail" id="infoDetail">
                        <div class="info-part-icon" id="infoIcon"><i class="fas fa-bone"></i></div>
                        <div class="info-part-name" id="infoName">-</div>
                        <div class="info-part-region" id="infoRegion">-</div>
                        <div class="info-section">
                            <div class="info-section-title"><i class="fas fa-info-circle"></i> Description</div>
                            <div class="info-description" id="infoDesc">-</div>
                        </div>
                        <div class="info-section">
                            <div class="info-section-title"><i class="fas fa-exclamation-triangle"></i> Possible Causes</div>
                            <ul class="causes-list" id="infoCauses"></ul>
                        </div>
                        <div class="info-section">
                            <div class="info-section-title"><i class="fas fa-notes-medical"></i> Common Symptoms</div>
                            <ul class="symptoms-list" id="infoSymptoms"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== SELECTED PANEL ===== -->
        <div class="selected-panel">
            <div class="selected-panel-header">
                <h3>
                    <i class="fas fa-check-circle" style="color:var(--primary)"></i>
                    Selected Areas
                    <span class="selected-count" id="selectedCount">0</span>
                </h3>
                <button class="btn-clear" id="btnClear" style="display:none"><i class="fas fa-times"></i> Clear All</button>
            </div>
            <div class="selected-tags" id="selectedTags">
                <span class="empty-selection">No areas selected yet. Click on muscle groups above.</span>
            </div>
            <div class="submit-row">
                <button class="btn-submit" id="btnSubmit" disabled><i class="fas fa-paper-plane"></i> Submit Symptoms</button>
                <span class="submit-hint" id="submitHint">Select at least one area</span>
            </div>
        </div>
    </div>

    <!-- ===== JAVASCRIPT ===== -->
    <script>
    (() => {
        const bodyData = {
            "Head": {
                region: "Cranium", icon: "fa-brain",
                desc: "The head encompasses the skull, brain, facial muscles, eyes, ears, sinuses, and jaw. It is the centre of the nervous system.",
                causes: ["Tension headache","Migraine","Sinusitis","Concussion","Eye strain","Hypertension"],
                symptoms: ["Throbbing or dull ache","Light sensitivity","Nausea / dizziness","Blurred vision"]
            },
            "Head (Back)": {
                region: "Occipital Region", icon: "fa-brain",
                desc: "The back of the head includes the occipital bone and suboccipital muscles controlling head extension and rotation.",
                causes: ["Tension headache","Occipital neuralgia","Cervicogenic headache","Whiplash","Stress"],
                symptoms: ["Pain at base of skull","Sensitivity behind ears","Stiff neck","Radiating pain over scalp"]
            },
            "Neck": {
                region: "Cervical", icon: "fa-head-side-cough",
                desc: "The anterior neck contains the sternocleidomastoid, scalenes, and deep cervical flexors.",
                causes: ["Muscle strain","Cervical disc herniation","Poor posture","Whiplash","Thyroid disorder"],
                symptoms: ["Stiffness","Radiating pain to shoulder","Numbness in arms","Difficulty turning head"]
            },
            "Neck (Back)": {
                region: "Posterior Cervical", icon: "fa-head-side-cough",
                desc: "Posterior neck muscles include upper trapezius, splenius, and semispinalis supporting the head.",
                causes: ["Text neck / forward head posture","Cervical spondylosis","Muscle spasm","Facet joint irritation"],
                symptoms: ["Stiffness at base of skull","Pain on looking up","Headache","Muscle knots"]
            },
            "Left Trapezius": {
                region: "Upper Back / Shoulder", icon: "fa-arrows-up-down",
                desc: "The trapezius is a large triangular muscle spanning the neck, shoulders, and upper back.",
                causes: ["Stress tension","Poor posture","Repetitive overhead movement","Nerve compression","Fibromyalgia"],
                symptoms: ["Shoulder tightness","Muscle knots","Pain turning head","Headache from tension"]
            },
            "Right Trapezius": {
                region: "Upper Back / Shoulder", icon: "fa-arrows-up-down",
                desc: "The right trapezius works bilaterally with the left to stabilize the shoulder girdle and spine.",
                causes: ["Mouse arm / desk posture","Carrying heavy bags","Muscle strain","Pinched nerve","Stress"],
                symptoms: ["Shoulder tightness","Referred headache","Pain on shoulder shrug","Trigger points"]
            },
            "Left Deltoid": {
                region: "Shoulder", icon: "fa-hand-fist",
                desc: "The deltoid covers the shoulder joint. The anterior head assists in forward arm elevation and internal rotation.",
                causes: ["Rotator cuff injury","Impingement syndrome","Bursitis","Frozen shoulder","Tendinitis"],
                symptoms: ["Pain lifting arm","Weakness in overhead motion","Clicking","Night pain"]
            },
            "Right Deltoid": {
                region: "Shoulder", icon: "fa-hand-fist",
                desc: "The right anterior deltoid is commonly overworked in dominant-arm activities.",
                causes: ["Rotator cuff tear","Tendinitis","AC joint injury","Bursitis","Labral tear"],
                symptoms: ["Pain reaching overhead","Arm weakness","Shoulder instability","Swelling"]
            },
            "Left Rear Deltoid": {
                region: "Posterior Shoulder", icon: "fa-hand-fist",
                desc: "The posterior deltoid extends and externally rotates the arm.",
                causes: ["Rotator cuff strain","Posterior impingement","Teres minor injury","Muscle imbalance"],
                symptoms: ["Pain reaching behind back","Weakness pulling","Shoulder blade pain","Popping"]
            },
            "Right Rear Deltoid": {
                region: "Posterior Shoulder", icon: "fa-hand-fist",
                desc: "The right rear deltoid works with the infraspinatus and teres minor to externally rotate the shoulder.",
                causes: ["Overuse injury","Posterior capsule tightness","Infraspinatus strain","Poor posture"],
                symptoms: ["Deep shoulder ache","Weakness in external rotation","Stiffness","Clicking"]
            },
            "Left Pectoral": {
                region: "Chest", icon: "fa-heart-pulse",
                desc: "The pectoralis major is a large fan-shaped chest muscle responsible for arm adduction, flexion, and internal rotation.",
                causes: ["Muscle strain","Costochondritis","Angina (referred)","Rib fracture","Acid reflux"],
                symptoms: ["Chest tightness","Pain on pushing","Sharp pain on deep breath","Radiating to arm"]
            },
            "Right Pectoral": {
                region: "Chest", icon: "fa-heart-pulse",
                desc: "The right pectoralis major mirrors the left. Commonly strained during bench press or push-ups.",
                causes: ["Pec strain or tear","Costochondritis","Intercostal strain","Anxiety/panic","GERD"],
                symptoms: ["Pain when pressing","Chest wall tenderness","Difficulty pushing","Bruising"]
            },
            "Left Bicep": {
                region: "Upper Arm \u2013 Anterior", icon: "fa-dumbbell",
                desc: "The biceps brachii crosses both the shoulder and elbow joints. It flexes the elbow and supinates the forearm.",
                causes: ["Bicep tendinitis","Muscle strain","SLAP tear","Nerve impingement","Overuse"],
                symptoms: ["Pain bending elbow","Weakness curling","Tenderness at shoulder","Popeye deformity (tear)"]
            },
            "Right Bicep": {
                region: "Upper Arm \u2013 Anterior", icon: "fa-dumbbell",
                desc: "The right bicep is typically the dominant arm\u2019s primary flexor.",
                causes: ["Distal bicep tendinitis","Muscle tear","Referred shoulder pain","Repetitive strain"],
                symptoms: ["Elbow anterior pain","Weakness turning doorknob","Swelling","Cramping"]
            },
            "Left Tricep": {
                region: "Upper Arm \u2013 Posterior", icon: "fa-dumbbell",
                desc: "The triceps brachii is the primary elbow extensor, making up ~60% of the upper arm mass.",
                causes: ["Tricep tendinitis","Muscle strain","Olecranon bursitis","Nerve entrapment"],
                symptoms: ["Pain straightening arm","Elbow posterior ache","Weakness pushing","Swelling at elbow"]
            },
            "Right Tricep": {
                region: "Upper Arm \u2013 Posterior", icon: "fa-dumbbell",
                desc: "The right tricep handles much of the pushing and extending work in the dominant arm.",
                causes: ["Overuse strain","Tendon inflammation","Radial nerve compression","Elbow hyperextension"],
                symptoms: ["Pain during push-ups","Elbow stiffness","Weakness extending","Tingling in forearm"]
            },
            "Upper Abdominals": {
                region: "Core \u2013 Upper", icon: "fa-shield-halved",
                desc: "The upper rectus abdominis flexes the trunk and compresses the abdominal cavity.",
                causes: ["Muscle strain","Acid reflux/GERD","Gastritis","Hiatal hernia","Costochondritis"],
                symptoms: ["Upper belly pain","Pain on crunching","Bloating","Difficulty bending forward"]
            },
            "Lower Abdominals": {
                region: "Core \u2013 Lower", icon: "fa-shield-halved",
                desc: "The lower rectus abdominis stabilizes the pelvis and controls pelvic tilt.",
                causes: ["Muscle strain","Appendicitis","IBS","Hernia","Urinary tract infection"],
                symptoms: ["Lower belly pain","Pain on leg raises","Cramping","Bloating"]
            },
            "Left Oblique": {
                region: "Core \u2013 Lateral", icon: "fa-rotate",
                desc: "The external and internal obliques on the left side enable trunk rotation and lateral flexion.",
                causes: ["Side strain","Intercostal strain","Kidney stones (referred)","Muscle spasm","Hernia"],
                symptoms: ["Pain twisting","Side stitch","Pain on coughing/sneezing","Flank tenderness"]
            },
            "Right Oblique": {
                region: "Core \u2013 Lateral", icon: "fa-rotate",
                desc: "The right obliques produce rotational force for trunk rotation.",
                causes: ["Side strain","Gallbladder pain (referred)","Muscle tear","Appendicitis (referred)"],
                symptoms: ["Right flank pain","Pain on rotation","Tenderness on palpation","Cramping"]
            },
            "Left Forearm": {
                region: "Forearm", icon: "fa-hand",
                desc: "The forearm contains flexors and extensors controlling wrist and finger movement.",
                causes: ["Carpal tunnel (radiating)","Tennis elbow","Forearm splints","Fracture","Nerve entrapment"],
                symptoms: ["Aching along forearm","Weak grip","Tingling in fingers","Pain twisting wrist"]
            },
            "Right Forearm": {
                region: "Forearm", icon: "fa-hand",
                desc: "The right forearm handles most gripping and writing tasks.",
                causes: ["Lateral epicondylitis","Medial epicondylitis","Carpal tunnel","Tendinitis","Compartment syndrome"],
                symptoms: ["Pain gripping","Burning forearm","Tightness","Numbness in hand"]
            },
            "Left Hand": {
                region: "Extremity", icon: "fa-hand",
                desc: "The hand has 27 bones, intrinsic muscles, and over 30 articulations.",
                causes: ["Carpal tunnel","Arthritis","Trigger finger","Ganglion cyst","Raynaud's disease"],
                symptoms: ["Numbness/tingling","Finger stiffness","Weak grip","Morning pain"]
            },
            "Right Hand": {
                region: "Extremity", icon: "fa-hand",
                desc: "The dominant hand is susceptible to repetitive stress injuries.",
                causes: ["Carpal tunnel","De Quervain's","Osteoarthritis","Dupuytren's contracture","Fracture"],
                symptoms: ["Pain writing/typing","Swollen joints","Difficulty gripping","Night tingling"]
            },
            "Hip / Pelvis": {
                region: "Hip / Core", icon: "fa-bone",
                desc: "The pelvic girdle connects the spine to the legs. Supports abdominal organs and transmits weight.",
                causes: ["Hip flexor strain","Bursitis","Labral tear","Sciatica","Hernia","Pelvic floor dysfunction"],
                symptoms: ["Groin pain","Hip stiffness","Pain climbing stairs","Lower abdominal discomfort"]
            },
            "Left Quadricep": {
                region: "Anterior Thigh", icon: "fa-person-walking",
                desc: "The quadriceps is a four-headed muscle and the strongest muscle group in the body.",
                causes: ["Quad strain","Patellar tendinitis","Contusion (dead leg)","Referred hip pain","Femoral nerve issue"],
                symptoms: ["Pain walking/running","Weakness going upstairs","Swelling","Cramping"]
            },
            "Right Quadricep": {
                region: "Anterior Thigh", icon: "fa-person-walking",
                desc: "The right quadricep bears tremendous load during running, jumping, and squatting.",
                causes: ["Muscle strain","Patellofemoral syndrome","IT band friction","Contusion","Stress fracture"],
                symptoms: ["Thigh front pain","Knee ache","Weakness standing from sitting","Bruising"]
            },
            "Left Inner Thigh": {
                region: "Medial Thigh", icon: "fa-person-walking",
                desc: "The adductor group pulls the legs together and stabilizes the pelvis during walking.",
                causes: ["Groin strain","Adductor tendinitis","Sports hernia","Hip joint referred pain"],
                symptoms: ["Inner thigh pain","Pain spreading legs","Groin tenderness","Pain running"]
            },
            "Right Inner Thigh": {
                region: "Medial Thigh", icon: "fa-person-walking",
                desc: "The right adductors are frequently strained in sports requiring direction changes.",
                causes: ["Adductor strain","Osteitis pubis","Obturator nerve entrapment","Hip pathology"],
                symptoms: ["Groin pain on movement","Inner thigh tenderness","Weakness pulling leg in","Stiffness"]
            },
            "Left Knee": {
                region: "Joint", icon: "fa-bone",
                desc: "The knee is the body\u2019s largest synovial joint with ACL, PCL, menisci, and patellar tendon.",
                causes: ["ACL/MCL tear","Meniscus tear","Osteoarthritis","Patellar tendinitis","Bursitis"],
                symptoms: ["Pain bending/extending","Swelling","Locking sensation","Instability"]
            },
            "Right Knee": {
                region: "Joint", icon: "fa-bone",
                desc: "The right knee handles daily stress from walking, running, and lifting.",
                causes: ["Runner's knee","Ligament sprain","Cartilage damage","Gout","Patellar dislocation"],
                symptoms: ["Stair pain","Popping/crunching","Stiffness after rest","Visible swelling"]
            },
            "Left Knee (Back)": {
                region: "Posterior Knee", icon: "fa-bone",
                desc: "The posterior knee includes the popliteal fossa, hamstring insertions, and gastrocnemius origins.",
                causes: ["Baker's cyst","Hamstring tendinitis","PCL injury","DVT","Popliteal artery entrapment"],
                symptoms: ["Swelling behind knee","Pain straightening leg","Calf tightness","Warmth/redness"]
            },
            "Right Knee (Back)": {
                region: "Posterior Knee", icon: "fa-bone",
                desc: "The right posterior knee is vulnerable to overuse injuries and cyst formation.",
                causes: ["Baker's cyst","Hamstring strain","PCL sprain","Meniscal cyst","Nerve entrapment"],
                symptoms: ["Fullness behind knee","Pain on full extension","Clicking","Night aching"]
            },
            "Left Shin": {
                region: "Anterior Lower Leg", icon: "fa-shoe-prints",
                desc: "The tibialis anterior runs along the shin and dorsiflexes the foot.",
                causes: ["Shin splints","Stress fracture","Compartment syndrome","Tibialis anterior tendinitis"],
                symptoms: ["Pain along shin bone","Aching during running","Swelling","Pain on dorsiflexion"]
            },
            "Right Shin": {
                region: "Anterior Lower Leg", icon: "fa-shoe-prints",
                desc: "The right shin area is commonly affected by overuse in runners.",
                causes: ["Shin splints","Stress fracture","Exertional compartment syndrome","Periostitis"],
                symptoms: ["Activity-related shin pain","Tenderness on bone","Mild swelling","Pain at start of exercise"]
            },
            "Left Calf": {
                region: "Posterior Lower Leg", icon: "fa-shoe-prints",
                desc: "The gastrocnemius and soleus form the calf, powering plantarflexion.",
                causes: ["Calf strain","DVT","Achilles tendinitis","Muscle cramp","Peripheral artery disease"],
                symptoms: ["Calf tightness","Pain on tiptoe","Swelling","Sudden sharp pain (strain)"]
            },
            "Right Calf": {
                region: "Posterior Lower Leg", icon: "fa-shoe-prints",
                desc: "The right calf muscles undergo tremendous eccentric load during running.",
                causes: ["Gastrocnemius tear","Soleus strain","DVT","Varicose veins","Compartment syndrome"],
                symptoms: ["Pain walking uphill","Cramping at night","Warmth/redness (DVT)","Muscle hardness"]
            },
            "Left Foot": {
                region: "Extremity", icon: "fa-shoe-prints",
                desc: "The foot has 26 bones, 33 joints, and over 100 tendons/ligaments.",
                causes: ["Plantar fasciitis","Bunions","Flat feet","Gout","Stress fracture","Neuropathy"],
                symptoms: ["Heel pain (morning)","Arch ache","Toe stiffness","Burning/tingling"]
            },
            "Right Foot": {
                region: "Extremity", icon: "fa-shoe-prints",
                desc: "The right foot typically has the push-off role in gait.",
                causes: ["Plantar fasciitis","Morton's neuroma","Metatarsalgia","Achilles pain","Bone spurs"],
                symptoms: ["Ball-of-foot pain","Heel tenderness","Toe numbness","Pain barefoot"]
            },
            "Left Upper Back": {
                region: "Posterior Thoracic", icon: "fa-arrows-up-down",
                desc: "The left upper back includes the rhomboids, infraspinatus, and teres major/minor.",
                causes: ["Poor posture","Rhomboid strain","Thoracic disc herniation","Scapular winging","Referred organ pain"],
                symptoms: ["Pain between shoulder blades","Stiffness","Burning sensation","Pain on deep breath"]
            },
            "Right Upper Back": {
                region: "Posterior Thoracic", icon: "fa-arrows-up-down",
                desc: "The right upper back muscles counter the pull of the chest muscles and maintain upright posture.",
                causes: ["Muscle strain","Thoracic outlet syndrome","Rib dysfunction","Trigger points","Scoliosis"],
                symptoms: ["Interscapular pain","Muscle knots","Pain on arm movement","Postural ache"]
            },
            "Spine / Mid Back": {
                region: "Thoracolumbar Spine", icon: "fa-bone",
                desc: "The spinal column includes thoracic and lumbar vertebrae with erector spinae muscles alongside.",
                causes: ["Disc herniation","Spondylosis","Muscle spasm","Compression fracture","Ankylosing spondylitis"],
                symptoms: ["Central back pain","Stiffness","Pain bending forward","Radiating pain around ribs"]
            },
            "Left Latissimus Dorsi": {
                region: "Mid Back \u2013 Lateral", icon: "fa-arrows-up-down",
                desc: "The latissimus dorsi is the widest muscle of the body. It extends, adducts, and internally rotates the arm.",
                causes: ["Lat strain","Overuse in swimming/climbing","Thoracodorsal nerve injury","Muscle spasm"],
                symptoms: ["Pain reaching overhead","Side back ache","Weakness pulling","Pain with lat stretch"]
            },
            "Right Latissimus Dorsi": {
                region: "Mid Back \u2013 Lateral", icon: "fa-arrows-up-down",
                desc: "The right lat is essential for rowing, pulling, and climbing movements.",
                causes: ["Muscle strain","Overuse injury","Referred kidney pain","Trigger points"],
                symptoms: ["Pain pulling objects","Lower side back ache","Muscle stiffness","Weakness"]
            },
            "Lower Back": {
                region: "Lumbar / Sacral", icon: "fa-bone",
                desc: "The lower back supports 80% of body weight. Low back pain affects ~80% of adults.",
                causes: ["Muscle strain","Herniated disc","Sciatica","Spinal stenosis","Degenerative disc disease","Kidney infection"],
                symptoms: ["Dull constant ache","Sharp pain on movement","Pain radiating to legs","Morning stiffness"]
            },
            "Left Glute": {
                region: "Buttock", icon: "fa-person-walking",
                desc: "The gluteus maximus is the body\u2019s largest and most powerful muscle.",
                causes: ["Piriformis syndrome","Sciatica","Gluteal tendinopathy","SI joint dysfunction","Bursitis"],
                symptoms: ["Deep buttock pain","Pain sitting","Radiating leg pain","Stiffness rising from chair"]
            },
            "Right Glute": {
                region: "Buttock", icon: "fa-person-walking",
                desc: "The right glute fires powerfully during single-leg stance.",
                causes: ["Piriformis syndrome","Gluteal strain","Hip bursitis","Sacroiliac dysfunction","Referred disc pain"],
                symptoms: ["Pain walking uphill","Sitting discomfort","Pain lying on side","Weakness in hip extension"]
            },
            "Left Hamstring": {
                region: "Posterior Thigh", icon: "fa-person-running",
                desc: "The hamstrings flex the knee and extend the hip. Most commonly strained muscles in sports.",
                causes: ["Hamstring strain","Sciatica","Proximal tendinopathy","Ischial bursitis","Muscle imbalance"],
                symptoms: ["Pain bending over","Sudden sharp pain (strain)","Tightness behind thigh","Bruising"]
            },
            "Right Hamstring": {
                region: "Posterior Thigh", icon: "fa-person-running",
                desc: "The right hamstrings decelerate the leg during sprinting.",
                causes: ["Acute strain","Chronic tendinitis","Referred lumbar pain","Nerve tension","Muscle weakness"],
                symptoms: ["Pain sprinting","Stiffness after sitting","Pain on straight leg raise","Weakness bending knee"]
            },
            "Left Achilles": {
                region: "Posterior Ankle", icon: "fa-shoe-prints",
                desc: "The Achilles tendon is the thickest tendon in the body, connecting the calf to the heel.",
                causes: ["Achilles tendinitis","Partial tear","Bursitis","Insertional tendinopathy"],
                symptoms: ["Heel cord pain","Stiffness in morning","Pain on calf raise","Swelling above heel"]
            },
            "Right Achilles": {
                region: "Posterior Ankle", icon: "fa-shoe-prints",
                desc: "The right Achilles tendon undergoes up to 8x body weight force during running.",
                causes: ["Tendinitis","Rupture risk","Haglund's deformity","Paratendinitis"],
                symptoms: ["Pain at back of ankle","Morning heel stiffness","Pain climbing stairs","Tenderness on squeeze"]
            }
        };

        /* ========== STATE ========== */
        const selectedParts = new Set();
        let currentView = 'front';

        /* ========== DOM ========== */
        const $ = id => document.getElementById(id);
        const infoPlaceholder = $('infoPlaceholder');
        const infoDetail      = $('infoDetail');
        const infoIcon        = $('infoIcon');
        const infoName        = $('infoName');
        const infoRegion      = $('infoRegion');
        const infoDesc        = $('infoDesc');
        const infoCauses      = $('infoCauses');
        const infoSymptoms    = $('infoSymptoms');
        const selectedTags    = $('selectedTags');
        const selectedCount   = $('selectedCount');
        const btnClear        = $('btnClear');
        const btnSubmit       = $('btnSubmit');
        const submitHint      = $('submitHint');
        const tooltip         = $('muscleTooltip');

        /* ========== VIEW TOGGLE ========== */
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                document.querySelectorAll('.body-view').forEach(v => v.classList.remove('active'));
                $(currentView === 'front' ? 'frontView' : 'backView').classList.add('active');
                syncVisuals();
            });
        });

        /* ========== INFO ========== */
        function showInfo(name) {
            const d = bodyData[name];
            if (!d) return;
            infoPlaceholder.style.display = 'none';
            infoDetail.classList.add('visible');
            infoIcon.innerHTML = '<i class="fas ' + (d.icon || 'fa-bone') + '"></i>';
            infoName.textContent = name;
            infoRegion.textContent = d.region;
            infoDesc.textContent = d.desc;
            infoCauses.innerHTML = d.causes.map(c => '<li><i class="fas fa-exclamation-circle"></i>' + c + '</li>').join('');
            infoSymptoms.innerHTML = d.symptoms.map(s => '<li><i class="fas fa-check"></i>' + s + '</li>').join('');
        }

        /* ========== TOOLTIP ========== */
        function showTooltip(e, name) {
            tooltip.textContent = name;
            tooltip.classList.add('show');
            const rect = document.querySelector('.svg-wrapper').getBoundingClientRect();
            tooltip.style.left = (e.clientX - rect.left) + 'px';
            tooltip.style.top = (e.clientY - rect.top - 12) + 'px';
        }

        /* ========== SELECTION ========== */
        function toggleSelection(name) {
            if (selectedParts.has(name)) selectedParts.delete(name);
            else selectedParts.add(name);
            syncVisuals();
            renderTags();
        }

        function syncVisuals() {
            document.querySelectorAll('.muscle').forEach(el => {
                el.classList.toggle('selected', selectedParts.has(el.dataset.name));
            });
        }

        function renderTags() {
            const n = selectedParts.size;
            selectedCount.textContent = n;
            if (n === 0) {
                selectedTags.innerHTML = '<span class="empty-selection">No areas selected yet. Click on muscle groups above.</span>';
                btnClear.style.display = 'none';
                btnSubmit.disabled = true;
                submitHint.textContent = 'Select at least one area';
            } else {
                let h = '';
                selectedParts.forEach(name => {
                    h += '<span class="selected-tag" data-name="'+name+'" title="Click to remove"><i class="fas fa-map-marker-alt"></i>'+name+'<i class="fas fa-times tag-remove"></i></span>';
                });
                selectedTags.innerHTML = h;
                btnClear.style.display = '';
                btnSubmit.disabled = false;
                submitHint.textContent = n + ' area' + (n > 1 ? 's' : '') + ' selected';
                selectedTags.querySelectorAll('.selected-tag').forEach(tag => {
                    tag.addEventListener('click', () => { selectedParts.delete(tag.dataset.name); syncVisuals(); renderTags(); });
                });
            }
        }

        /* ========== EVENTS ========== */
        document.querySelectorAll('.muscle').forEach(el => {
            const name = el.dataset.name;
            if (!name) return;
            el.addEventListener('mouseenter', e => { showInfo(name); showTooltip(e, name); });
            el.addEventListener('mousemove', e => showTooltip(e, name));
            el.addEventListener('mouseleave', () => tooltip.classList.remove('show'));
            el.addEventListener('click', () => { toggleSelection(name); showInfo(name); });
        });

        btnClear.addEventListener('click', () => {
            selectedParts.clear();
            syncVisuals();
            renderTags();
            infoPlaceholder.style.display = '';
            infoDetail.classList.remove('visible');
        });

        /* ========== SUBMIT ========== */
        btnSubmit.addEventListener('click', async () => {
            if (selectedParts.size === 0) return;
            const orig = btnSubmit.innerHTML;
            btnSubmit.disabled = true;
            btnSubmit.innerHTML = '<div class="spinner"></div> Submitting...';
            try {
                const parts = Array.from(selectedParts);
                const resp = await fetch('/submit_body_selection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        selected_parts: parts,
                        details: parts.map(n => ({
                            id: n.toLowerCase().replace(/[\s\/()]/g, '_'),
                            name: n,
                            causes: bodyData[n]?.causes || [],
                            symptoms: bodyData[n]?.symptoms || []
                        }))
                    })
                });
                const data = await resp.json();
                if (data.success) {
                    showAlert('success', data.message || 'Submitted!');
                    if (data.redirect) setTimeout(() => window.location.href = data.redirect, 1500);
                } else {
                    showAlert('error', data.message || 'Submission failed');
                }
            } catch (err) {
                showAlert('error', 'Network error. Please try again.');
            } finally {
                btnSubmit.disabled = selectedParts.size === 0;
                btnSubmit.innerHTML = orig;
            }
        });

        /* ========== ALERT ========== */
        function showAlert(type, msg) {
            const old = document.querySelector('.alert');
            if (old) old.remove();
            const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle' };
            const div = document.createElement('div');
            div.className = 'alert alert-' + type;
            div.innerHTML = '<i class="fas ' + (icons[type]||'fa-info-circle') + '"></i> ' + msg;
            document.body.appendChild(div);
            setTimeout(() => { div.style.opacity = '0'; div.style.transition = 'opacity .3s'; setTimeout(() => div.remove(), 300); }, 4000);
        }
    })();
    </script>
</body>
</html>
